<view class="container">
  <view class="header">
    <text class="title">商品管理</text>
    <text class="subtitle">管理积分兑换商品</text>
  </view>

  <view class="category-tabs">
    <view class="tab {{activeCategory === 'all' ? 'active' : ''}}" bindtap="switchCategory" data-category="all">全部</view>
    <view class="tab {{activeCategory === '清洁用品' ? 'active' : ''}}" bindtap="switchCategory" data-category="清洁用品">清洁用品</view>
    <view class="tab {{activeCategory === '食品' ? 'active' : ''}}" bindtap="switchCategory" data-category="食品">食品</view>
    <view class="tab {{activeCategory === '日用品' ? 'active' : ''}}" bindtap="switchCategory" data-category="日用品">日用品</view>
    <view class="tab {{activeCategory === '其他' ? 'active' : ''}}" bindtap="switchCategory" data-category="其他">其他</view>
  </view>

  <view class="product-list">
    <view class="product-card {{item.stock_quantity <= 5 ? 'low-stock' : ''}}" wx:for="{{filteredProducts}}" wx:key="id">
      <view class="product-header">
        <view class="category-tag">{{item.category}}</view>
        <view class="status-badge {{item.status === 1 ? 'active' : 'inactive'}}">
          {{item.status === 1 ? '上架' : '下架'}}
        </view>
      </view>
      
      <view class="product-body">
        <text class="product-name">{{item.name}}</text>
        <view class="product-info">
          <text class="points">{{item.points_price}}积分</text>
          <text class="unit">/{{item.unit}}</text>
        </view>
        <view class="stock-info">
          <text class="stock">库存：{{item.stock_quantity}}{{item.unit}}</text>
          <text class="warning" wx:if="{{item.stock_quantity <= 5}}">库存不足</text>
        </view>
      </view>

      <view class="product-footer">
        <switch checked="{{item.status === 1}}" bindchange="toggleStatus" data-id="{{item.id}}"/>
        <button class="btn-edit" bindtap="editProduct" data-id="{{item.id}}">编辑</button>
        <button class="btn-delete" bindtap="deleteProduct" data-id="{{item.id}}">删除</button>
      </view>
    </view>
  </view>

  <view class="add-btn" bindtap="showAddModal">
    <text>+ 新增商品</text>
  </view>

  <!-- 新增/编辑弹窗 -->
  <view class="modal" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="hideModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{isEdit ? '编辑商品' : '新增商品'}}</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">商品名称</text>
          <input placeholder="如：洗衣粉" value="{{form.name}}" bindinput="onNameInput"/>
        </view>
        <view class="form-item">
          <text class="form-label">分类</text>
          <picker mode="selector" range="{{categories}}" bindchange="onCategoryChange">
            <view class="picker">{{form.category || '请选择分类'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="form-label">兑换积分</text>
          <input type="number" placeholder="如：10" value="{{form.points_price}}" bindinput="onPointsInput"/>
        </view>
        <view class="form-item">
          <text class="form-label">库存数量</text>
          <input type="number" placeholder="如：50" value="{{form.stock_quantity}}" bindinput="onStockInput"/>
        </view>
        <view class="form-item">
          <text class="form-label">单位</text>
          <input placeholder="如：袋、瓶、个" value="{{form.unit}}" bindinput="onUnitInput"/>
        </view>
        <view class="form-item">
          <text class="form-label">状态</text>
          <switch checked="{{form.status === 1}}" bindchange="onStatusChange"/>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-cancel" bindtap="hideModal">取消</button>
        <button class="btn-confirm" bindtap="saveProduct">保存</button>
      </view>
    </view>
  </view>
</view>
